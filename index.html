<!DOCTYPE html>
<html>
<head>
	<title>MeetingHall</title>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script type="text/javascript">
		Object.defineProperty(Number.prototype, "toRadians", {
			enumerable: false,
			value: function() {
				return this * Math.PI / 180;
			}
		});
		Object.defineProperty(Number.prototype, "toDegrees", {
			enumerable: false,
			value: function() {
				return this * (180 / Math.PI);
			}
		});

		function calcdist([lat1, lon1], [lat2, lon2]) {
			// Calculate distance between two latlongs
			var R = 6378137; // metres
			var φ1 = lat1.toRadians();
			var φ2 = lat2.toRadians();
			var Δφ = (lat2-lat1).toRadians();
			var Δλ = (lon2-lon1).toRadians();

			var a = Math.sin(Δφ/2) * Math.sin(Δφ/2) +
				   Math.cos(φ1) * Math.cos(φ2) *
				   Math.sin(Δλ/2) * Math.sin(Δλ/2);
			var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

			var d = R * c;
			return d;
		}

		function calcbearing([lat1, lon1], [lat2, lon2]) {
			var φ1 = lat1.toRadians();
			var φ2 = lat2.toRadians();
			var λ1 = lon1.toRadians();
			var λ2 = lon2.toRadians();
			var Δφ = (lat2-lat1).toRadians();
			var Δλ = (lon2-lon1).toRadians();

			var y = Math.sin(λ2-λ1) * Math.cos(φ2);
			var x = Math.cos(φ1)*Math.sin(φ2) -
				Math.sin(φ1)*Math.cos(φ2)*Math.cos(λ2-λ1);
			var brng = Math.atan2(y, x).toDegrees();
			return brng;
		}
	</script>
</head>
<body>
	<h3>Google Maps</h3>
	<div id="map"></div>
	<div id="info"></div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script>

		var nummarkers = 0; // Number of markers on the map
		var markers = []; // Array of latitudes and longitudes of the markers
		var mapMarkers = []; // Array of markers on the map

		function initMap() {
			var map = new google.maps.Map(document.getElementById('map'), {
				zoom: 1,
				center: {lat: 0, lng: 0},
				mapTypeId: google.maps.MapTypeId.ROADMAP
			});

			google.maps.event.addListener(map, 'click', function(event) {
				placeMarker(event.latLng, event);
			});


			function setMarkers() {
				for (var i = 0; i < mapMarkers.length; i++) {
					mapMarkers[i].setMap(map); //Add the marker to the map
				}
			}
			function clearMarkers() {
				for (var i = 0; i < mapMarkers.length; i++) {
					mapMarkers[i].setMap(null); //Remove the marker from the map
				}
				mapMarkers = []; // Delete all markers
			}


			function placeMarker(location, event) {
				nummarkers = nummarkers + 1;
				
				if(nummarkers > 2) {
					clearMarkers();
					markers = []
					nummarkers = 0;
				} else {
					mapMarkers.push(
						new google.maps.Marker({
							position: location
						})
					);
					setMarkers();
					markers.push([location.lat(), location.lng()])

					console.log(markers);
					console.log(nummarkers);

					if(nummarkers == 2) {
						distance = calcdist(markers[0], markers[1]);
						bearing = calcbearing(markers[0], markers[1]);
						$('#info').html(
							"<b>Distance:</b> " + distance + 
							"<b>Bearing:</b> " + bearing);
					}
				}
			}


		}
	</script>
	<script async defer
	src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBN8R5GiMfrknBTSZENSItv91Vh9JfFTE4&callback=initMap">
	</script>
	<script src="graphs.js"></script>
	<script src="data.js"></script>
</body>
</html>